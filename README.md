# 自由進度学習支援システム

## プロジェクト概要

**名前**: 自由進度学習支援システム  
**目標**: 子どもたちが自ら考え実行する力を育み、個別最適な学びを実現する  
**主要機能**: 
- 学年・教科・単元別の学習カード
- 3コース制（じっくり・しっかり・ぐんぐん）による個別最適化
- AI先生によるソクラテス対話
- リアルタイム進捗可視化
- 非認知能力の育成と評価
- 学習計画と振り返り機能

## URL

- **開発環境**: https://3000-ifkm81ji5x491axns53a8-b9b802c4.sandbox.novita.ai
- **GitHub**: （未設定）

## 🎉 実装完了した全機能

### ✅ フェーズ1：基本機能（完了）

1. **トップページ**
   - 学年選択（小学1年〜中学3年）
   - 教科選択（算数など）
   - 教科書会社選択（東京書籍など）
   - 単元選択
   - ユーザー情報表示

2. **学習のてびき**
   - 単元目標の表示
   - 非認知能力目標の表示
   - 授業時間の表示
   - 3コース選択問題（じっくり・しっかり・ぐんぐん）
   - チェックテスト説明
   - 選択問題6題の一覧表示
   - ツールバー（学習計画表・解答・進捗ボード）

3. **コース選択後の学習カード一覧**
   - 各コースの学習カード表示（6枚）
   - 難易度表示（基本・標準・発展）
   - 実社会との関連表示

### ✅ フェーズ2：学習機能（完了）

4. **学習カード詳細ページ**
   - 新出語句・キーワード表示
   - 例題と解き方の提示
   - 問題文と回答欄
   - 実社会との関連付け
   - 進捗バー表示

5. **ヒントカード機能**
   - 3段階のヒント表示
   - アコーディオン形式で開閉
   - 思考ツールの提案
   - 「9割型答えられる」設計

6. **AI先生（ソクラテス対話）**
   - Gemini API統合
   - チャット形式の対話
   - 答えを教えず考えを引き出す
   - 小学生向けの言葉選び
   - 励ましのメッセージ

7. **助けを求める機能**
   - 右上固定の助けボタン
   - 4つの選択肢：
     - 💡 ヒントカード
     - 🤖 AI先生に聞く
     - 👨‍🏫 先生を呼ぶ
     - 👥 友達に聞く
   - 助け要請回数の記録

8. **分かった度評価**
   - 5段階の絵文字選択
     - 😢 わからない
     - 😕 少し難しい
     - 😊 だいたいOK
     - 😄 よくわかる
     - 🤩 完璧！
   - 視覚的フィードバック

9. **学習進捗保存**
   - 理解度レベルの記録
   - 助け要請タイプの記録
   - 助けを求めた回数の記録
   - データベースへの自動保存

10. **解答表示機能**
    - 解答と解説のトグル表示
    - 詳細な解説付き

### ✅ フェーズ3：計画と管理機能（完了）

11. **学習計画表**
    - 単元全体の計画作成
    - 予定日・実施日の記録
    - 学習カード選択
    - オリエンテーションとまとめ（固定）
    - テーブル形式の一覧表示

12. **振り返り機能**
    - モーダルウィンドウでの記入
    - 3つの観点：
      - 😊 良かったこと
      - 😕 難しかったこと
      - 💡 わかったこと
    - 振り返り内容の保存と編集

13. **振り返りAI**
    - Gemini API統合
    - 個別フィードバック
    - 励ましと次へのヒント
    - 150文字以内の簡潔なメッセージ

14. **単元全体の振り返り**
    - 単元で学んだことの記録
    - 次に学びたいことの記録
    - メタ認知の促進

15. **解答タブ**
    - コース別解答表示
      - 🟢 じっくりコース
      - 🔵 しっかりコース
      - 🟣 ぐんぐんコース
    - 選択問題の解答例
    - 詳細な解説
    - 解答活用のヒント

### ✅ フェーズ4：教師支援機能（完了）

16. **進捗ボード**
    - クラス全体の進捗可視化
    - 児童別の棒グラフ表示
    - コース別色分け（緑・青・紫）
    - 進捗パーセント表示
    - リアルタイム更新

17. **助け要請可視化**
    - 先生を呼んでいる児童の一覧
    - オレンジ色のマーク表示
    - 要請時刻の表示

18. **停滞検知**
    - 10分以上停滞している児童の検出
    - 赤色のマーク表示
    - 停滞時間の表示

19. **助けの統計**
    - ヒント使用回数
    - AI先生利用回数
    - 先生呼び出し回数
    - 友達への相談回数

20. **理解度分布**
    - 5段階評価の分布グラフ
    - 児童数とパーセント表示
    - 絵文字による視覚化

21. **指導のポイント**
    - 優先的な声かけ対象の提示
    - 停滞児童への対応提案
    - 個別指導の推奨
    - 発展課題の提案

## データアーキテクチャ

### データモデル

**主要テーブル:**
- `users`: 教師・児童情報
- `classes`: クラス情報
- `curriculum`: カリキュラム（学年・教科・単元）
- `courses`: コース情報（基礎・標準・発展）
- `learning_cards`: 学習カード
- `hint_cards`: ヒントカード
- `optional_problems`: 選択問題（発展学習）
- `student_progress`: 学習進捗
- `learning_plans`: 学習計画
- `evaluations`: 評価データ
- `answers`: 解答と解説
- `learning_environment`: 学習環境デザイン
- `custom_content`: カスタマイズコンテンツ

### ストレージサービス

- **Cloudflare D1**: SQLiteベースの分散データベース
- **ローカル開発**: `.wrangler/state/v3/d1`に自動生成

### データフロー

```
トップページ → 学習のてびき → コース選択 → 学習カード → 進捗保存
                     ↓              ↓              ↓
              学習計画表      進捗ボード      解答タブ
                     ↓              ↓
              振り返りAI      助け要請検知
```

## 主要な機能URI

### API エンドポイント

| エンドポイント | メソッド | 説明 | パラメータ |
|--------------|---------|------|-----------|
| `/api/curriculum/options` | GET | 学年・教科・教科書会社の選択肢取得 | なし |
| `/api/curriculum` | GET | カリキュラム一覧取得 | なし |
| `/api/curriculum/:id` | GET | 特定カリキュラムの詳細取得 | id: カリキュラムID |
| `/api/courses/:courseId/cards` | GET | コースの学習カード取得 | courseId: コースID |
| `/api/cards/:cardId` | GET | 学習カードの詳細とヒント取得 | cardId: カードID |
| `/api/progress` | POST | 学習進捗の保存 | student_id, curriculum_id, など |
| `/api/progress/class/:classCode` | GET | クラス全体の進捗取得 | classCode: クラスコード |
| `/api/progress/curriculum/:curriculumId/class/:classCode` | GET | カリキュラム別進捗取得 | curriculumId, classCode |
| `/api/plans/:studentId/:curriculumId` | GET | 学習計画取得 | studentId, curriculumId |
| `/api/plans` | POST | 学習計画保存 | student_id, curriculum_id, など |
| `/api/plans/:id` | PUT | 学習計画更新 | id: 計画ID |
| `/api/ai/ask` | POST | AI先生に質問 | cardId, question, context |
| `/api/ai/reflect` | POST | AI振り返りフィードバック | reflection_good, reflection_bad, など |
| `/api/answers/curriculum/:curriculumId` | GET | 全解答取得 | curriculumId: カリキュラムID |

### ページ一覧

| ページ | 説明 | アクセス |
|--------|------|---------|
| トップページ | 学年・教科・単元選択 | `/` |
| 学習のてびき | 単元全体の概要 | 単元選択後 |
| 学習カード | 問題・ヒント・AI先生 | コース選択後 |
| 学習計画表 | 計画・振り返り | 学習のてびきから |
| 解答タブ | 全解答と解説 | 学習のてびきから |
| 進捗ボード | クラス全体の進捗 | 学習のてびきから |

## 実装済み機能の詳細

### 児童向け機能

1. **自己調整学習**
   - 学習計画の作成
   - 自分のペースで進行
   - 振り返りの記録

2. **個別最適化**
   - 3コース制（じっくり・しっかり・ぐんぐん）
   - 自分に合ったコースを選択
   - 理解度に応じた学習

3. **多様な支援**
   - ヒントカード（3段階）
   - AI先生（ソクラテス対話）
   - 先生への助け要請
   - 友達との学び合い

4. **メタ認知の育成**
   - 分かった度の自己評価
   - 毎時間の振り返り
   - 単元全体の振り返り

### 教師向け機能

1. **進捗管理**
   - クラス全体の可視化
   - リアルタイム更新
   - コース別色分け

2. **早期介入**
   - 助け要請の検知
   - 停滞児童の発見
   - 指導優先度の提示

3. **データ分析**
   - 助けの種類別統計
   - 理解度の分布
   - 学習進捗の推移

4. **指導支援**
   - 指導のポイント提示
   - 個別指導の推奨
   - 発展課題の提案

## サンプルデータ

**単元**: 小学3年算数「かけ算の筆算」  
**クラス**: さくら小学校 3年1組 (CLASS2024A)  
**児童数**: 5名（山田太郎、佐藤花子、鈴木次郎、田中三郎、伊藤美咲）  
**コース数**: 3コース（じっくり・しっかり・ぐんぐん）  
**学習カード数**: 18枚（各コース6枚）  
**選択問題数**: 6題  
**ヒント数**: 各カード3段階

### コース別学習カード

**じっくりコース（基礎）:**
1. 10のまとまりでかける
2. 何十のかけ算
3. 2けた×1けた（くり上がりなし）
4. 2けた×1けた（くり上がりあり）
5. 3けた×1けた（くり上がりなし）
6. 3けた×1けた（くり上がりあり）

**しっかりコース（標準）:**
1. かけ算の意味をふかめよう
2. 2けた×1けたの筆算（基本）
3. 2けた×1けた（くり上がり1回）
4. 3けた×1けた（くり上がりなし）
5. 3けた×1けた（くり上がり1回）
6. 3けた×1けた（くり上がり2回）

**ぐんぐんコース（発展）:**
1. かけ算のきまりを見つけよう
2. 2けた×1けた（応用問題）
3. 3けた×1けた（基礎から応用）
4. くり上がり2回の難問に挑戦
5. かけ算を使った問題づくり
6. かけ算のまちがい探し

### 選択問題（発展学習）

1. かけ算カレンダー作り（表現・クリエイティブ）
2. お店屋さんごっこ（調査・フィールドワーク）
3. かけ算の不思議を調べよう（多角的考察）
4. 学校のため算数プロジェクト（社会貢献）
5. かけ算日記をつけよう（メタ認知）
6. かけ算ゲーム大会（表現・クリエイティブ）

## 教育哲学

**基本概念**: 「子どもは自ら考え実行する力をもっている存在である」

### 育みたい力

1. **体験・感覚・具体操作**を大切にする
2. **感じる力**
3. **意欲**
4. **好き（興味・関心）**
5. **個別最適な個性**

### システムが目指すもの

- 子どもの自立
- AI時代における人間としての力
- 学びのハンドルを子ども自身が握る
- 教師の業務負担軽減
- 授業スタイルの転換
- 子ども観の変革

## 技術スタック

### バックエンド
- **フレームワーク**: Hono v4
- **言語**: TypeScript
- **実行環境**: Cloudflare Workers
- **データベース**: Cloudflare D1 (SQLite)
- **AI**: Gemini API (Google)

### フロントエンド
- **言語**: Vanilla JavaScript
- **スタイリング**: TailwindCSS (CDN)
- **アイコン**: Font Awesome (CDN)
- **HTTP Client**: Axios (CDN)

### 開発環境
- **ビルドツール**: Vite
- **プロセス管理**: PM2
- **バージョン管理**: Git

## デプロイメント

### 開発環境

- **プラットフォーム**: Cloudflare Pages (ローカル開発モード)
- **ステータス**: ✅ Active
- **URL**: https://3000-ifkm81ji5x491axns53a8-b9b802c4.sandbox.novita.ai

### ローカル開発コマンド

```bash
# データベースのリセット
npm run db:reset

# ローカル開発サーバー起動
npm run dev:sandbox

# ビルド
npm run build

# PM2で起動
pm2 start ecosystem.config.cjs

# PM2ログ確認
pm2 logs --nostream

# PM2停止
pm2 delete webapp
```

### 本番デプロイ（準備完了）

```bash
# 本番データベース作成
npx wrangler d1 create webapp-production

# マイグレーション適用
npm run db:migrate:prod

# デプロイ
npm run deploy:prod
```

## 環境変数設定

### Gemini APIキー

`.dev.vars` ファイルに設定：

```
GEMINI_API_KEY=your-gemini-api-key-here
```

**APIキーの取得:**
https://makersuite.google.com/app/apikey

## 今後の拡張可能な機能

### フェーズ5：カスタマイズ機能（未実装）

1. **先生カスタマイズモード**
   - 問題編集機能
   - カスタムコンテンツ作成
   - 学習カードの追加・削除

2. **指導・評価タブ**
   - 3観点評価（ABC）
   - 非認知能力評価
   - 指導上の留意点記録

3. **学習環境デザイン**
   - 6カテゴリの環境提案
   - アフォーダンス理論実装
   - 教室環境の具体化

### フェーズ6：多言語・アクセシビリティ（未実装）

4. **多言語対応**
   - 多言語選択機能
   - 自動翻訳機能

5. **音声支援**
   - Text-to-Speech機能
   - 問題文の読み上げ

6. **動的視覚支援**
   - アニメーション
   - インタラクティブ図表

## 開発の記録

### Git コミット履歴

```
feat: 進捗ボード実装 - クラス全体の可視化、助け要請検知、停滞検知、統計表示
feat: 学習計画表と解答タブ実装 - 計画作成、振り返り、AI振り返り、全解答表示
feat: 学習カード詳細ページ実装 - 問題表示、ヒント、ソクラテス対話、分かった度評価
feat: フェーズ1実装完了 - トップページ、学習のてびき、コース選択
Initial commit: Hono project setup
```

## 最終更新日

2026-01-12

---

**開発者へ**: このシステムは、子どもたちの自律的な学びと先生方の働き方改革を両立させることを目指しています。一つひとつの機能が、子どもたちの成長と先生方の支援につながることを常に意識して開発を進めてください。

**すべてのコア機能が実装完了しました！🎉**
